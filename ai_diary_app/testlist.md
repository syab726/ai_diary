# AdMob 광고 통합 테스트 리스트

## 개요

이 문서는 AI 그림일기 앱에 Google AdMob 광고를 통합한 후 테스트해야 할 항목들을 정리한 문서입니다.

**구현 일자**: 2025-10-18
**AdMob SDK 버전**: google_mobile_ads ^5.2.0

## 테스트 환경

### 필수 확인 사항
- [ ] `.env` 파일이 존재하며 테스트 광고 ID가 설정되어 있는지 확인
- [ ] `flutter pub get` 실행 완료
- [ ] Android 에뮬레이터 또는 실제 디바이스 연결
- [ ] iOS 시뮬레이터 또는 실제 디바이스 연결

### 테스트 광고 ID 확인
**.env 파일 내용:**
```
ADMOB_REWARDED_AD_UNIT_ID_ANDROID=ca-app-pub-3940256099942544/5224354917
ADMOB_REWARDED_AD_UNIT_ID_IOS=ca-app-pub-3940256099942544/1712485313
ADMOB_BANNER_AD_UNIT_ID_ANDROID=ca-app-pub-3940256099942544/6300978111
ADMOB_BANNER_AD_UNIT_ID_IOS=ca-app-pub-3940256099942544/2934735716
```

---

## 1. 무료 사용자 테스트 케이스

### 1.1 보상형 광고 - 새 일기 이미지 생성
**테스트 시나리오:**
1. 무료 사용자로 로그인
2. 일기 작성 화면 이동
3. 일기 내용 입력 후 "일기 생성" 버튼 클릭
4. 보상형 광고가 표시되는지 확인
5. 광고 시청 완료 후 이미지 생성이 진행되는지 확인

**기대 결과:**
- [ ] 보상형 광고가 전체 화면으로 표시됨
- [ ] 광고 시청 완료 시 이미지 생성이 시작됨
- [ ] 콘솔에 "[광고] 무료 사용자 - 보상형 광고 표시 시작" 로그 출력
- [ ] 콘솔에 "[광고] 광고 시청 완료" 로그 출력

### 1.2 보상형 광고 - 이미지 재생성
**테스트 시나리오:**
1. 무료 사용자로 로그인
2. 이미 생성된 일기의 이미지 재생성 버튼 클릭
3. 보상형 광고가 표시되는지 확인
4. 광고 시청 완료 후 이미지 재생성이 진행되는지 확인

**기대 결과:**
- [ ] 보상형 광고가 전체 화면으로 표시됨
- [ ] 광고 시청 완료 시 이미지 재생성이 시작됨

### 1.3 배너 광고 - 일기 목록 화면
**테스트 시나리오:**
1. 무료 사용자로 로그인
2. 일기 목록 화면 확인

**기대 결과:**
- [ ] 화면 하단에 배너 광고가 고정 표시됨
- [ ] 광고 로딩 중에는 "광고 로딩 중..." 플레이스홀더 표시
- [ ] 배너 광고와 일기 목록이 겹치지 않음 (60px 하단 여백)
- [ ] 스크롤 시 배너 광고는 화면 하단에 고정됨

### 1.4 프리미엄 구독 화면 - 광고 제거 혜택 표시
**테스트 시나리오:**
1. 무료 사용자로 로그인
2. 설정 > 프리미엄 구독 화면 이동
3. 프리미엄 기능 목록 확인

**기대 결과:**
- [ ] "광고 제거" 항목이 프리미엄 기능 목록의 첫 번째로 표시됨
- [ ] 아이콘: Icons.block (빨간색)
- [ ] 설명: "모든 광고 없이\n쾌적한 일기 작성 경험"

---

## 2. 프리미엄 사용자 테스트 케이스

### 2.1 보상형 광고 없음 - 이미지 생성
**테스트 시나리오:**
1. 프리미엄 사용자로 전환 (설정 > 프리미엄 구독 > 테스트 모드 구독)
2. 일기 작성 화면에서 일기 생성
3. 광고 없이 바로 이미지 생성이 시작되는지 확인

**기대 결과:**
- [ ] 보상형 광고가 표시되지 않음
- [ ] 일기 생성 버튼 클릭 후 바로 이미지 생성 시작
- [ ] 콘솔에 광고 관련 로그가 출력되지 않음

### 2.2 배너 광고 없음 - 일기 목록 화면
**테스트 시나리오:**
1. 프리미엄 사용자로 로그인
2. 일기 목록 화면 확인

**기대 결과:**
- [ ] 화면 하단에 배너 광고가 표시되지 않음
- [ ] 하단 여백도 없음 (광고 공간이 없으므로)

### 2.3 프리미엄 전환 후 광고 제거 확인
**테스트 시나리오:**
1. 무료 사용자로 시작
2. 배너 광고가 표시되는 것 확인
3. 프리미엄으로 전환
4. 일기 목록 화면으로 돌아와서 배너 광고가 사라졌는지 확인

**기대 결과:**
- [ ] 프리미엄 전환 후 배너 광고가 즉시 사라짐
- [ ] 하단 여백도 제거됨

---

## 3. 광고 로드 실패 시 동작 테스트

### 3.1 보상형 광고 로드 실패
**테스트 시나리오:**
1. 무료 사용자로 로그인
2. 네트워크 연결 끊기 (비행기 모드)
3. 일기 생성 시도

**기대 결과:**
- [ ] 광고 로드 실패해도 기능 차단되지 않음
- [ ] 이미지 생성이 정상적으로 진행됨
- [ ] 콘솔에 "[AdService] 보상형 광고 로드 실패 - 기능 허용" 로그 출력

### 3.2 배너 광고 로드 실패
**테스트 시나리오:**
1. 무료 사용자로 로그인
2. 네트워크 연결 끊기
3. 일기 목록 화면 확인

**기대 결과:**
- [ ] "광고 로딩 중..." 플레이스홀더가 계속 표시됨
- [ ] 앱 크래시 없이 정상 작동
- [ ] 콘솔에 "[AdBannerWidget] 배너 광고 로드 실패" 로그 출력

---

## 4. 광고 자동 재로드 테스트

### 4.1 보상형 광고 자동 재로드
**테스트 시나리오:**
1. 무료 사용자로 로그인
2. 일기 생성 (보상형 광고 시청)
3. 광고 닫힌 후 콘솔 로그 확인
4. 다시 일기 생성 시도

**기대 결과:**
- [ ] 첫 번째 광고 닫힌 후 콘솔에 "[AdService] 보상형 광고 닫힘" 로그
- [ ] 자동으로 다음 광고 로드 시작 (로그 확인)
- [ ] 두 번째 일기 생성 시 광고가 정상 표시됨

### 4.2 배너 광고 라이프사이클
**테스트 시나리오:**
1. 무료 사용자로 로그인
2. 일기 목록 화면 진입 (배너 광고 로드)
3. 다른 화면으로 이동
4. 다시 일기 목록 화면으로 돌아오기

**기대 결과:**
- [ ] 처음 진입 시 광고 로드 및 표시
- [ ] 화면 이탈 시 광고 dispose (메모리 해제)
- [ ] 재진입 시 새로운 광고 로드

---

## 5. 플랫폼별 테스트

### 5.1 Android 테스트
**환경:**
- Android 에뮬레이터 또는 실제 디바이스
- Android API 레벨 21 이상

**확인 사항:**
- [ ] AndroidManifest.xml에 INTERNET 권한이 있는지 확인
- [ ] AndroidManifest.xml에 AdMob App ID가 설정되어 있는지 확인
- [ ] 보상형 광고가 정상 작동하는지 확인
- [ ] 배너 광고가 정상 표시되는지 확인
- [ ] 광고 클릭 시 외부 브라우저로 이동하는지 확인

**테스트 광고 ID (Android):**
- 보상형: ca-app-pub-3940256099942544/5224354917
- 배너: ca-app-pub-3940256099942544/6300978111

### 5.2 iOS 테스트
**환경:**
- iOS 시뮬레이터 또는 실제 디바이스
- iOS 14.0 이상

**확인 사항:**
- [ ] Info.plist에 GADApplicationIdentifier가 설정되어 있는지 확인
- [ ] Info.plist에 NSUserTrackingUsageDescription이 있는지 확인
- [ ] Info.plist에 SKAdNetworkItems가 있는지 확인
- [ ] 보상형 광고가 정상 작동하는지 확인
- [ ] 배너 광고가 정상 표시되는지 확인
- [ ] iOS 14+ 에서 App Tracking Transparency 팝업이 표시되는지 확인 (실제 광고 ID 사용 시)

**테스트 광고 ID (iOS):**
- 보상형: ca-app-pub-3940256099942544/1712485313
- 배너: ca-app-pub-3940256099942544/2934735716

---

## 6. 콘솔 로그 확인

### 6.1 AdMob 초기화
**확인할 로그:**
```
[AdService] AdMob SDK 초기화 완료
[AdService] 보상형 광고 로드 시작...
[AdService] 보상형 광고 로드 성공
```

### 6.2 보상형 광고 표시
**확인할 로그:**
```
[광고] 무료 사용자 - 보상형 광고 표시 시작
[AdService] 보상형 광고 표시 시작
[AdService] 사용자가 보상 획득: 1 Reward
[광고] 광고 시청 완료
[AdService] 보상형 광고 닫힘
```

### 6.3 배너 광고 로드
**확인할 로그:**
```
[AdBannerWidget] 배너 광고 로드 성공
```

### 6.4 광고 로드 실패
**확인할 로그:**
```
[AdService] 보상형 광고 로드 실패: [오류 내용]
[AdService] 보상형 광고 로드 실패 - 기능 허용
```
또는
```
[AdBannerWidget] 배너 광고 로드 실패: [오류 내용]
```

---

## 7. 실제 광고 ID로 전환하기 전 체크리스트

**중요:** 실제 AdMob 광고 ID로 전환하기 전 다음 사항을 반드시 확인하세요.

- [ ] 모든 테스트 케이스를 테스트 광고 ID로 통과했는지 확인
- [ ] AdMob 계정이 생성되어 있고, 앱이 등록되어 있는지 확인
- [ ] AdMob에서 실제 광고 단위 ID를 생성했는지 확인
- [ ] `.env` 파일의 광고 ID를 실제 ID로 교체
- [ ] 앱이 Google Play / App Store에 배포되기 전까지는 테스트 디바이스로 등록하여 테스트
- [ ] 앱 배포 후 광고 노출 및 수익 확인

**주의사항:**
- 테스트 광고로 실제 클릭을 하면 AdMob 계정이 정지될 수 있습니다.
- 실제 광고 ID 사용 시 본인의 광고를 클릭하지 마세요.
- AdMob 정책을 반드시 준수하세요.

---

## 8. 문제 해결 가이드

### 문제 1: 광고가 로드되지 않음
**가능한 원인:**
- 네트워크 연결 문제
- 광고 ID가 잘못 설정됨
- AdMob SDK 초기화 실패

**해결 방법:**
1. 네트워크 연결 확인
2. `.env` 파일의 광고 ID 확인
3. 콘솔 로그에서 오류 메시지 확인
4. `flutter clean && flutter pub get` 실행 후 재빌드

### 문제 2: 앱 크래시
**가능한 원인:**
- AdMob SDK 버전 충돌
- 네이티브 설정 누락

**해결 방법:**
1. `pubspec.yaml`에서 google_mobile_ads 버전 확인 (^5.2.0)
2. AndroidManifest.xml 및 Info.plist 설정 재확인
3. `flutter clean` 후 재빌드

### 문제 3: 광고 표시 후 기능이 작동하지 않음
**가능한 원인:**
- onUserEarnedReward 콜백이 호출되지 않음
- 광고 닫힘 후 상태 업데이트 실패

**해결 방법:**
1. AdService의 showRewardedAd 메서드 로직 확인
2. 콘솔 로그에서 보상 획득 여부 확인
3. 광고 닫힘 후 리로드 로직 확인

---

## 테스트 완료 체크리스트

모든 테스트를 완료한 후 다음 항목을 확인하세요:

- [ ] 무료 사용자 - 보상형 광고 테스트 완료
- [ ] 무료 사용자 - 배너 광고 테스트 완료
- [ ] 프리미엄 사용자 - 광고 없음 테스트 완료
- [ ] 광고 로드 실패 시 동작 테스트 완료
- [ ] Android 플랫폼 테스트 완료
- [ ] iOS 플랫폼 테스트 완료
- [ ] 콘솔 로그 확인 완료
- [ ] 문제 없이 모든 시나리오 통과

**테스트 완료 일자**: __________
**테스터**: __________
**비고**: __________
