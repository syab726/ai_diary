# ArtDiary AI 업그레이드 TODO

## 즉시 개선 가능 (이번 세션)

### ✅ 1. 프로그레스 단계별 표시 (완료 - v1.1)
**파일:** `lib/screens/diary_create_screen.dart:588-606`
**완료 상태:** v1.1 (2025-10-10)에서 완료
**구현 내용:**
- 사진 분석 중... (사진이 있을 때)
- 감정 분석 중...
- 키워드 추출 중...
- 이미지 프롬프트 생성 중...
- AI 이미지 생성 중...

### ✅ 2. 페이지 인디케이터 크기 증가 (완료 - v1.1)
**파일:** `lib/screens/diary_detail_screen.dart:776-810`
**완료 상태:** v1.1 (2025-10-10)에서 완료
**구현 내용:** 일반 페이지 10x10, 현재 페이지 12x12로 증가

### 3. 디버그 로그 정리
**대상 파일들:**
- `lib/services/ai_service.dart` - 40+ print 문
- `lib/services/database_service.dart` - 20+ print 문
- `lib/screens/diary_list_screen.dart` - 15+ print 문
- `lib/screens/diary_detail_screen.dart` - 10+ print 문
- `lib/screens/diary_create_screen.dart` - 10+ print 문
**개선 내용:**
- 프로덕션 빌드에서 print 제거 (kDebugMode 사용)
- logger 패키지 도입 고려
**우선순위:** 중간

---

## 단기 개선 (1-2주)

### 4. 성능 최적화
**문제:** "Skipped 127 frames! The application may be doing too much work on its main thread"
**개선 내용:**
- 이미지 로딩 최적화
  - 썸네일 생성 및 캐싱
  - 이미지 리사이징 (현재 원본 그대로 로드)
  - `cacheExtent` 설정 추가
- 데이터베이스 쿼리 최적화
  - 인덱스 추가 (createdAt, emotion)
  - 페이지네이션 구현 (현재 전체 로드)
- AI 처리 백그라운드화
  - Isolate 사용 검토
**우선순위:** 높음

### 4-1. AI 이미지 생성 비동기 처리 및 큐 시스템 (신규)
**현재 문제:**
- 유저가 몰릴 경우 Gemini API IPM(Images Per Minute) 한도 초과 가능
- 동기적 처리로 인한 앱 응답성 저하
- 실패 시 재시도 메커니즘 부재
- 생성 진행 상황 추적 어려움
**파일:** `lib/services/ai_service.dart`

**구현 방안:**
1. **백엔드 서버 구축 (권장)**
   - Firebase Cloud Functions 또는 Node.js 백엔드
   - 메시지 큐 시스템:
     - Option A: Firebase Pub/Sub (Firebase 생태계 통합)
     - Option B: Redis Queue (자체 서버)
     - Option C: Cloud Tasks (GCP)
   - 워커 서버: IPM 한도 관리하며 순차 처리
   - 데이터베이스: 요청 상태 추적 (pending/processing/completed/failed)

2. **프론트엔드 변경사항**
   - 이미지 생성 요청 → 큐에 추가 (즉시 리턴)
   - 진행 상황 표시:
     - "대기 중... (현재 X번째)"
     - "이미지 생성 중..."
     - "완료!"
   - 실시간 상태 업데이트:
     - Firebase Realtime Database 또는 Firestore 구독
     - 또는 주기적 폴링 (5초마다)
   - 알림 시스템:
     - 푸시 알림 (Firebase Cloud Messaging)
     - 인앱 알림

3. **워커 로직**
   - Rate Limiting: IPM 한도 준수 (예: 15 IPM)
   - 우선순위 큐: 프리미엄 사용자 우선 처리
   - 재시도 로직: 실패 시 3회 재시도 (exponential backoff)
   - 타임아웃: 각 요청 최대 60초
   - 에러 핸들링: 사용자에게 명확한 에러 메시지

4. **데이터베이스 스키마 (예시)**
   ```
   image_generation_requests:
     - id: auto
     - userId: string
     - diaryId: string
     - status: pending/processing/completed/failed
     - prompt: text
     - options: json
     - queuePosition: int
     - createdAt: timestamp
     - startedAt: timestamp (nullable)
     - completedAt: timestamp (nullable)
     - resultImageUrl: string (nullable)
     - errorMessage: string (nullable)
     - retryCount: int (default: 0)
   ```

5. **구현 단계**
   - Phase 1: 백엔드 API 및 큐 시스템 구축
   - Phase 2: 프론트엔드 비동기 처리 전환
   - Phase 3: 실시간 상태 업데이트 구현
   - Phase 4: 알림 시스템 추가
   - Phase 5: 모니터링 및 최적화

**예상 효과:**
- API 한도 초과 방지 (IPM 관리)
- 앱 응답성 향상 (비동기 처리)
- 사용자 경험 개선 (진행 상황 표시)
- 확장성 확보 (유저 증가에 대응)
- 안정성 향상 (재시도 로직, 에러 핸들링)

**우선순위:** 높음 (사용자 증가 대비 필수)
**예상 개발 기간:** 2-3주
**기술 스택 추천:**
- 백엔드: Firebase Cloud Functions (Node.js)
- 큐: Firebase Pub/Sub 또는 Cloud Tasks
- 실시간 통신: Firebase Firestore
- 알림: Firebase Cloud Messaging

### ✅ 5. 일기 백업/복원 기능 (완료 - v1.2)
**위치:** 설정 화면 > 백업 및 복원
**완료 상태:** v1.2 (2025-10-17)에서 완료
**구현 내용:**
- ✅ 로컬 백업/복원 (JSON 형식)
  - 일기 데이터 (제목, 내용, 날짜, 감정 등)
  - 이미지 파일들 (base64 인코딩)
- ✅ Google Drive 클라우드 백업/복원
  - 프리미엄: AI 생성 이미지 포함 전체 백업
  - 무료: 텍스트 및 메타데이터 백업
- ✅ 진행률 표시
- ✅ 자동 백업 옵션 (프리미엄 전용)
**파일:** `lib/screens/settings/backup_restore_screen.dart`, `lib/services/google_drive_service.dart`

### 6. 오류 처리 개선
**현재 문제:**
- 네트워크 오류 시 앱이 멈춤
- AI 생성 실패 시 재시도 없음
- 이미지 로드 실패 시 처리 미흡
**개선 내용:**
- 네트워크 오류 재시도 로직 (3회)
- 타임아웃 설정 추가
- 사용자 친화적인 에러 메시지
- 오프라인 감지 및 안내
**우선순위:** 높음

### 7. 캐시 삭제 기능
**위치:** `lib/screens/settings_screen.dart`
**구현 내용:**
- 이미지 캐시 크기 계산 및 표시
  - `/app_flutter/diary_images/` (AI 생성 이미지)
  - `/app_flutter/user_photos/` (사용자 업로드)
  - CachedNetworkImage 캐시
- 선택적 삭제 옵션
  - 임시 파일만
  - 캐시된 이미지
  - 전체 초기화
**우선순위:** 중간

---

## 중기 개선 (1개월)

### 8. 이미지 최적화
**문제:** 이미지 파일 크기가 큼 (AI 생성 이미지 1-2MB)
**개선 내용:**
- 이미지 압축 (flutter_image_compress)
- 리사이징 (최대 1080x1080)
- WebP 형식 사용 고려
- 썸네일 자동 생성
**우선순위:** 중간

### 9. 보안 개선
**현재 문제:** API 키가 하드코딩 (`lib/services/ai_service.dart:15`)
**개선 내용:**
- 환경 변수로 이동 (flutter_dotenv)
- .env 파일 생성 및 .gitignore 추가
- 프로덕션: 백엔드 API 프록시 사용
**우선순위:** 높음 (배포 전 필수)

### 10. 오프라인 모드 지원
**구현 내용:**
- 네트워크 연결 상태 감지
- 오프라인 시 일기 작성은 가능 (이미지 없이)
- 온라인 복귀 시 자동 동기화
- 대기 중인 작업 표시
**우선순위:** 중간

### ✅ 11. 클라우드 동기화 (완료 - v1.2)
**완료 상태:** v1.2 (2025-10-17)에서 Google Drive 백업/복원 완료
**구현 내용:**
- ✅ Google Drive를 통한 클라우드 백업/복원
- ✅ 프리미엄/무료 사용자 구분 백업
- ✅ 자동 백업 옵션 (프리미엄 전용)
- ⚠️ 여러 기기 간 실시간 동기화 - 미구현 (수동 백업/복원만 가능)
- ⚠️ 충돌 해결 로직 - 미구현
**파일:** `lib/services/google_drive_service.dart`

---

## 장기 개선 (2-3개월)

### 12. 실제 결제 시스템 연동
**현재 상태:** 프리미엄 기능이 있지만 결제 없음
**구현 내용:**
- Google Play Billing (Android)
- App Store In-App Purchase (iOS)
- 구독 상태 확인 및 복원
- 무료 평가판 (7일)
**우선순위:** 높음 (수익화 필수)

### 13. 앱 온보딩
**구현 내용:**
- 첫 실행 시 튜토리얼
- 주요 기능 설명 (이미지 생성, 갤러리, 통계)
- 샘플 일기 제공
- Skip 버튼
**우선순위:** 중간

### 14. 다크 모드
**구현 내용:**
- 다크 테마 정의
- 테마 전환 기능
- 시스템 설정 따라가기
- 이미지 뷰어 다크 모드 최적화
**우선순위:** 낮음

### 15. 성취 시스템
**구현 내용:**
- 연속 작성 일수 표시
- 배지 시스템
  - "7일 연속 작성"
  - "첫 AI 그림일기"
  - "50개 일기 작성"
- 성취 알림
**우선순위:** 낮음

### 16. 연간 리포트
**구현 내용:**
- 올해의 감정 통계
- 가장 많이 쓴 키워드
- 월별 작성 일수
- 올해의 베스트 일기 (좋아요 기능 필요)
- PDF 또는 이미지로 공유
**우선순위:** 낮음

---

## 기타 개선사항

### 17. 일기 작성 화면 개선
- 자동 저장 (draft)
- 글자수 카운터
- 작성 시간 표시
- 작성 중 경고 (뒤로가기 시)

### 18. 일기 상세 화면 개선
- 작성/수정 날짜 모두 표시
- 좋아요 또는 별점 기능
- 메모 추가 기능

### 19. 일기 목록 화면 개선
- 날짜 헤더 스티키
- 감정별 필터
- 정렬 옵션 (최신순, 오래된순, 감정별)

### 20. 설정 화면 개선
- 앱 버전 정보
- 이용약관 및 개인정보처리방침
- 문의하기 (이메일 또는 폼)
- 오픈소스 라이선스

---

## 완료된 기능 (참고)

### 핵심 기능
- ✅ AI 이미지 생성 (Gemini 2.5 Flash Image Preview)
- ✅ 사진 업로드 (무료 1장, 프리미엄 3장) - v1.2
- ✅ 사진 분위기 분석 및 프롬프트 반영
- ✅ 일기 작성/수정/삭제
- ✅ 일기 수정 (1회 이미지 재생성)

### 프리미엄 기능
- ✅ 프리미엄 글꼴 (10종) - v1.0
- ✅ 6가지 이미지 스타일
- ✅ 고급 이미지 옵션 (조명, 분위기, 색상, 구도)
- ✅ 시간대/날씨/계절 설정
- ✅ 무제한 이미지 생성
- ✅ 광고 제거

### UI/UX
- ✅ 프로그레스 단계별 표시 - v1.1
- ✅ 페이지 인디케이터 크기 개선 - v1.1
- ✅ 뒤로가기 버튼 통일
- ✅ 클릭 가능 영역 개선

### 데이터 관리
- ✅ 검색 기능
- ✅ 로컬 백업/복원 (JSON) - v1.2
- ✅ Google Drive 클라우드 백업/복원 - v1.2
- ✅ 자동 백업 (프리미엄) - v1.2

### 통계 및 분석
- ✅ 감정 통계 (주간/월간/연간) - v1.2
- ✅ 연도 선택 기능 - v1.2
- ✅ 연간 감정 인사이트 - v1.2
- ✅ AI 연간 분석 - v1.2
- ✅ 캘린더 뷰

### 기타
- ✅ 공유 기능 (텍스트/이미지)
- ✅ 4개 언어 지원 (한/일/영/중)
- ✅ Firebase 인증 (Google, Apple, 익명)

---

## 우선순위 요약 (2025-10-19 업데이트)

**긴급 (배포 전 필수):**
1. ⚠️ 보안 개선 (API 키) - 미완료
2. ⚠️ 실제 결제 시스템 연동 - 미완료

**높은 우선순위:**
1. ✅ ~~프로그레스 단계 표시~~ - 완료 (v1.1)
2. ✅ ~~페이지 인디케이터 크기~~ - 완료 (v1.1)
3. ⚠️ **AI 이미지 생성 비동기 처리 및 큐 시스템** - 신규 (사용자 증가 대비 필수)
4. ⚠️ 성능 최적화 - 미완료 (프레임 드롭 문제)
5. ⚠️ 오류 처리 개선 - 미완료

**중간 우선순위:**
1. ⚠️ 디버그 로그 정리 - 미완료
2. ✅ ~~일기 백업/복원~~ - 완료 (v1.2)
3. ⚠️ 캐시 삭제 기능 - 미완료
4. ⚠️ 이미지 최적화 - 미완료
5. ⚠️ 오프라인 모드 - 미완료

**낮은 우선순위:**
1. ⚠️ 앱 온보딩 - 미완료
2. ⚠️ 다크 모드 - 미완료
3. ⚠️ 성취 시스템 - 미완료
4. ⚠️ 연간 리포트 - 미완료

---

## 다음 개선 추천

**즉시 작업 가능:**
1. 디버그 로그 정리 (kDebugMode 사용)
2. 캐시 삭제 기능 추가

**단기 목표 (1-2주):**
1. 성능 최적화 (이미지 로딩, 데이터베이스 쿼리)
2. 오류 처리 개선 (네트워크 재시도, 타임아웃)
3. 이미지 최적화 (압축, 리사이징)

**중기 목표 (2-3주) - 사용자 증가 대비:**
1. **AI 이미지 생성 비동기 처리 및 큐 시스템 구축** (최우선)
   - Firebase Cloud Functions 백엔드 구축
   - 메시지 큐 시스템 도입 (Pub/Sub/Cloud Tasks)
   - IPM 한도 관리 워커 서버
   - 실시간 진행 상황 추적
   - 푸시 알림 시스템

**배포 전 필수:**
1. API 키 환경변수 이동 (보안)
2. AI 큐 시스템 구축 (확장성)
3. 실제 결제 시스템 연동 (수익화)
