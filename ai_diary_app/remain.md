# ArtDiary AI - 남은 작업 목록

**최종 업데이트:** 2025-10-21
**현재 완성도:** 85%

---

## 배포 전 필수 작업 (3주 예상)

### 1. API 키 보안 처리 ⚠️ CRITICAL
**예상 시간:** 0.5일
**난이도:** 쉬움
**현재 문제:**
- Gemini API 키가 `lib/services/ai_service.dart` 15번째 줄에 하드코딩
- 앱 디컴파일 시 API 키 노출 위험

**해결 방법:**
```
1. .env 파일 생성
2. .gitignore에 .env 추가
3. flutter_dotenv 패키지로 API 키 로드
4. ai_service.dart 수정
```

**체크리스트:**
- [ ] `.env` 파일 생성 및 API 키 이동
- [ ] `.gitignore`에 `.env` 추가
- [ ] `ai_service.dart` 수정 (dotenv 사용)
- [ ] 테스트 (앱 실행 확인)

---

### 2. 실제 결제 시스템 연동 ⚠️ CRITICAL
**예상 시간:** 5-7일
**난이도:** 어려움
**현재 상태:**
- in_app_purchase 패키지만 설치됨
- 프리미엄 UI는 있지만 실제 결제 불가

**필요 작업:**

#### 2-1. Google Play Billing (Android)
- [ ] Google Play Console에서 앱 등록
- [ ] 인앱 상품 생성 (월간 구독, 연간 구독)
- [ ] 결제 코드 작성
- [ ] 샌드박스 테스트

#### 2-2. App Store IAP (iOS)
- [ ] App Store Connect에서 앱 등록
- [ ] 구독 상품 생성
- [ ] 결제 코드 작성
- [ ] 샌드박스 테스트

#### 2-3. 공통 작업
- [ ] PurchaseService 완성
- [ ] 구독 상태 확인 로직
- [ ] 구독 복원 기능
- [ ] 무료 평가판 (7일) 구현
- [ ] 영수증 검증

**참고:**
- 패키지: `in_app_purchase`, `in_app_purchase_android`, `in_app_purchase_storekit`
- Google Play 수수료: 15% (첫 $1M까지)
- App Store 수수료: 15% (첫 $1M까지)

---

### 3. 성능 최적화
**예상 시간:** 2-3일
**난이도:** 중간
**현재 문제:**
- 콘솔 경고: "Skipped 127 frames!"
- 일기 목록 스크롤 시 버벅임

**해결 방법:**

#### 4-1. 이미지 로딩 최적화
- [ ] 썸네일 생성 (256x256)
- [ ] 이미지 압축 (flutter_image_compress)
- [ ] 리스트뷰에 cacheExtent 설정
- [ ] 이미지 lazy loading

#### 4-2. 데이터베이스 최적화
- [ ] 인덱스 추가 (createdAt, emotion)
- [ ] 페이지네이션 구현 (한 번에 20개씩)
- [ ] 쿼리 최적화

#### 4-3. AI 처리 백그라운드화
- [ ] Isolate 사용 고려
- [ ] 이미지 생성 비동기 처리 (위 3번과 연계)

**체크리스트:**
- [ ] 썸네일 생성 함수 작성
- [ ] 이미지 압축 적용
- [ ] 데이터베이스 인덱스 추가
- [ ] 페이지네이션 구현
- [ ] 테스트 (프레임 드롭 확인)

---

### 4. 오류 처리 개선
**예상 시간:** 1-2일
**난이도:** 쉬움-중간
**현재 문제:**
- 네트워크 오류 시 앱 멈춤
- AI 생성 실패 시 재시도 없음
- 에러 메시지가 불친절

**해결 방법:**

#### 5-1. 네트워크 오류 처리
```dart
Future<T> retryOnNetworkError<T>(Future<T> Function() fn) async {
  for (int i = 0; i < 3; i++) {
    try {
      return await fn().timeout(Duration(seconds: 30));
    } catch (e) {
      if (i == 2) rethrow;
      await Future.delayed(Duration(seconds: 2 * (i + 1)));
    }
  }
  throw Exception('Retry failed');
}
```

#### 5-2. 사용자 친화적 에러 메시지
- [ ] 네트워크 오류: "인터넷 연결을 확인해주세요"
- [ ] AI 생성 실패: "이미지 생성에 실패했습니다. 다시 시도해주세요"
- [ ] 저장 실패: "일기 저장에 실패했습니다"

#### 5-3. 오프라인 감지
- [ ] connectivity_plus 패키지 사용
- [ ] 오프라인 시 안내 배너 표시

**체크리스트:**
- [ ] retryOnNetworkError 헬퍼 함수 작성
- [ ] 모든 API 호출에 재시도 로직 적용
- [ ] 타임아웃 설정 (30초)
- [ ] 에러 메시지 한글화
- [ ] 오프라인 감지 및 안내
- [ ] 테스트

---

## 배포 전 권장 작업 (1주 예상)

### 5. 디버그 로그 정리
**예상 시간:** 0.5일
**난이도:** 쉬움
**대상 파일:**
- `lib/services/ai_service.dart` (40+ print 문)
- `lib/services/database_service.dart` (20+ print 문)
- `lib/screens/*.dart` (30+ print 문)

**해결 방법:**
```dart
// 기존
print('AI 이미지 생성 시작');

// 변경
if (kDebugMode) print('AI 이미지 생성 시작');
```

**체크리스트:**
- [ ] 모든 print 문에 kDebugMode 체크 추가
- [ ] 또는 logger 패키지 도입
- [ ] Release 빌드 테스트 (로그 없는지 확인)

---

### 6. 이미지 최적화
**예상 시간:** 1일
**난이도:** 중간
**현재 문제:**
- AI 생성 이미지 크기 1-2MB
- 저장 공간 빠르게 소모

**해결 방법:**
- [ ] 이미지 압축 (품질 85%)
- [ ] 리사이징 (최대 1080x1080)
- [ ] WebP 형식 사용 고려

**패키지:** `flutter_image_compress`, `image`

---

### 7. 개인정보처리방침 + 이용약관
**예상 시간:** 1-2일
**난이도:** 쉬움-중간
**필요성:** 앱스토어 심사 필수

**작업:**
- [ ] 개인정보처리방침 작성 (변호사 검토 권장)
- [ ] 이용약관 작성
- [ ] 웹페이지 호스팅 (Firebase Hosting 또는 GitHub Pages)
- [ ] 앱에 링크 추가

**참고:**
- 개인정보처리방침 생성기: https://www.privacy.go.kr/
- Firebase Hosting: 무료

---

## 선택 작업 (배포 후)

### 8. Firebase 인증 완성 (선택)
**예상 시간:** 3-4일
**난이도:** 어려움
**필요성:** 낮음 (현재 로컬 저장만으로 충분)

**작업:**
- [ ] Firebase Console 수동 설정
- [ ] AuthService 재작성 (700+ 줄)
- [ ] LoginScreen UI 재작성
- [ ] Firestore/Storage 연동

**판단 기준:**
- 다중 기기 동기화 필요하면 → 구현
- 로컬 저장만으로 충분하면 → 보류

---

### 9. 앱 온보딩
**예상 시간:** 1-2일
**난이도:** 쉬움-중간
**구현:**
- [ ] 첫 실행 시 튜토리얼
- [ ] 주요 기능 설명
- [ ] Skip 버튼

---

## 대규모 사용자 증가 후 작업

### 10. AI 이미지 생성 큐 시스템
**예상 시간:** 2-3주
**난이도:** 매우 어려움
**필요 조건:** DAU 1000명+ 또는 API 한도 초과 발생 시

**현재 상황:**
- 동기적 처리 방식 (즉시 생성)
- Gemini API IPM 한도: 15 IPM
- 초기 사용자 수: 예상 10-100명/일
- **현재 방식으로 충분함**

**큐 시스템이 필요한 시점:**
1. DAU 1000명 이상
2. API 한도 초과 오류 빈발
3. 사용자 불만 접수 (생성 실패)

**구현 방안:**
- Firebase Cloud Functions 백엔드
- Firebase Pub/Sub 메시지 큐
- Firestore 상태 추적
- FCM 푸시 알림
- 로컬 SQLite → Firestore 마이그레이션

**문제점:**
- 개발 시간: 2-3주
- 추가 비용: Firebase Functions, Pub/Sub
- 유지보수 복잡도 증가
- 데이터 마이그레이션 필요

**현실적 판단:**
- 초기에는 현재 방식 유지
- Firebase Analytics로 사용량 모니터링
- 실제 문제 발생 시 구축

**모니터링 지표:**
- DAU, MAU
- AI 이미지 생성 횟수/일
- API 한도 초과 오류 수
- 평균 대기 시간

---

## 작업 우선순위 요약

### 🔥 최우선 (배포 불가능)
1. API 키 보안 처리 (0.5일)
2. 실제 결제 시스템 (5-7일)

### ⚠️ 높음 (배포 가능하지만 문제 발생 가능)
3. 성능 최적화 (2-3일)
4. 오류 처리 개선 (1-2일)

### 📋 중간 (배포 전 권장)
5. 디버그 로그 정리 (0.5일)
6. 이미지 최적화 (1일)
7. 개인정보처리방침 + 이용약관 (1-2일)

### 💡 낮음 (배포 후)
8. Firebase 인증 (선택)
9. 앱 온보딩

### 🚀 대규모 사용자 증가 후
10. AI 큐 시스템 (DAU 1000명+ 또는 API 한도 초과 발생 시)

---

## 예상 일정

### 최소 배포 버전 (MVP)
**총 소요 시간:** 약 2주
- Week 1: API 키 보안 (0.5일) + 결제 시스템 시작 (3-4일) + 성능 최적화 시작 (1-2일)
- Week 2: 결제 시스템 완성 + 오류 처리 개선 + 테스트

### 안정적 배포 버전
**총 소요 시간:** 약 3주
- Week 1-2: 위와 동일
- Week 3: 디버그 로그 + 이미지 최적화 + 캐시 삭제 + 개인정보처리방침 + 최종 테스트

---

## 체크리스트 (배포 전 최종 점검)

### 보안
- [ ] API 키 환경변수 처리
- [ ] .env 파일 gitignore 확인
- [ ] Release 빌드 테스트

### 기능
- [ ] 결제 시스템 작동 확인 (샌드박스)
- [ ] 모든 핵심 기능 테스트

### 성능
- [ ] 프레임 드롭 해결 확인
- [ ] 이미지 로딩 속도 확인
- [ ] 메모리 사용량 확인

### 법적
- [ ] 개인정보처리방침 링크 확인
- [ ] 이용약관 링크 확인
- [ ] 오픈소스 라이선스 표기

### 스토어
- [ ] 앱 아이콘 최종 확인
- [ ] 스플래시 스크린 확인
- [ ] 스크린샷 준비 (5-8장)
- [ ] 앱 설명 작성 (한/영)

---

**참고:**
- upgrade_todo.md: 상세한 개선 계획
- TODO.md: Firebase 인증 관련
- CLAUDE.md: 프로젝트 전체 정보
